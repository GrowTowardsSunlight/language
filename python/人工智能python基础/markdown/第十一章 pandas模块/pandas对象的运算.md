numpyé€šç”¨å‡½æ•°åŒæ ·é€‚ç”¨äºpandasã€‚numpyçš„å‘é‡åŒ–è¿ç®—,çŸ©é˜µåŒ–è¿ç®—,å¹¿æ’­è¿ç®—åœ¨pandasä¸­ä¹Ÿä½¿ç”¨ã€‚è€Œpandasä¸­ç‰¹æœ‰çš„æ˜¯ç´¢å¼•å¯¹é½

ä¸€èˆ¬æ¥è¯´ï¼Œçº¯ç²¹çš„è®¡ç®—åœ¨numpyé‡Œæ‰§è¡Œå¾—æ›´å¿«ã€‚numpyæ›´ä¾§é‡äºè®¡ç®—ï¼Œpandasæ›´ä¾§é‡äºæ•°æ®å¤„ç†ã€‚

* [å‘é‡åŒ–è¿ç®—](#å‘é‡åŒ–è¿ç®—)
* [çŸ©é˜µè¿ç®—](#çŸ©é˜µè¿ç®—)
* [æ‰§è¡Œç›¸åŒè¿ç®—_numpyä¸pandasçš„å¯¹æ¯”](#æ‰§è¡Œç›¸åŒè¿ç®—_numpyä¸pandasçš„å¯¹æ¯”)

* [ç´¢å¼•å¯¹é½](#ç´¢å¼•å¯¹é½)
* [æ’åº](#æ’åº)
* [ç»Ÿè®¡](#)
* [applyè‡ªå®šä¹‰æ¯è¡Œæˆ–æ¯åˆ—ç›¸åº”æ“ä½œ](#applyè‡ªå®šä¹‰æ¯è¡Œæˆ–æ¯åˆ—ç›¸åº”æ“ä½œ)

* [å¤§é‡æ•°æ®çš„é«˜æ€§èƒ½è®¡ç®—](å¤§é‡æ•°æ®çš„é«˜æ€§èƒ½è®¡ç®—)

### å‘é‡åŒ–è¿ç®—

æ¯ä¸ªå…ƒç´ éƒ½è¿›è¡Œäº†ç›¸åº”çš„è¿ç®—ã€‚

- pandaså¯¹è±¡ä¸æ•°å­—çš„åŠ å‡ä¹˜é™¤

- pandaså¯¹è±¡ä¸pandaså¯¹è±¡çš„åŠ å‡ä¹˜é™¤

- å–åï¼Œä¹˜æ–¹ï¼Œæ±‚æ•´æ•°å•†ï¼Œæ±‚ä½™æ•°

- ç»å¯¹å€¼ï¼Œä¸‰è§’å‡½æ•°ï¼Œåä¸‰è§’å‡½æ•°ï¼ŒæŒ‡æ•°ï¼Œå¯¹æ•°

ä¸- [numpyæ•°ç»„çš„å‘é‡åŒ–è¿ç®—](https://github.com/zyxhzsh/artificial-intelligence/blob/master/äººå·¥æ™ºèƒ½pythonåŸºç¡€/markdown/ç¬¬åç« %20numpyæ¨¡å—/numpyæ•°ç»„çš„è¿ç®—.md)ä½¿ç”¨çš„ç¬¦å·å’Œå‡½æ•°ç›¸åŒã€‚
```python
x = pd.DataFrame(np.arange(4).reshape(1,4))
x + 5       #æ¯ä¸ªå…ƒç´ éƒ½åŠ 5
np.exp(x)   #æ¯ä¸ªå…ƒç´ éƒ½è¿›è¡ŒæŒ‡æ•°è¿ç®—

y = pd.DataFrame(np.arange(4,8).reshape(1,4))
x*y     #xä¸yç›¸åŒä½ç½®çš„å…ƒç´ ç›¸ä¹˜ï¼Œè‹¥å½¢çŠ¶ä¸åŒåˆ™å¹¿æ’­è¿ç®—ã€‚
```

### çŸ©é˜µåŒ–è¿ç®—

- è½¬ç½®ï¼šdf.T

- ä¹˜æ³•ï¼šdf1.dot(df2)æˆ–np.dot(df1,df2)
```python
ç”Ÿæˆä¸€ä¸ªçŸ©é˜µ
np.random.seed(42)
df1 = pd.DataFrame(np.random.randint(10,size=(10,10)))
df2 = pd.DataFrame(np.random.randint(10,size=(10,10)))

df1.T   #è½¬ç½®

%timeit df1.dot(df2)
æˆ–%timeit np.dot(df1,df2)     
#%timeit:ipythonä¸­ç»Ÿè®¡è¿è¡Œæ—¶é—´çš„é­”æœ¯æ–¹æ³•(å¤šæ¬¡è¿è¡Œå–å¹³å‡å€¼)
```

### æ‰§è¡Œç›¸åŒè¿ç®—_numpyä¸pandasçš„å¯¹æ¯”

ä»¥ä¹˜æ³•ä¸ºğŸŒ°
```python
np1 = np.array(df1)     #æŠŠDataFrameå¯¹è±¡è½¬æ¢æˆnumpyå¯¹è±¡
np2 = np.array(df2)

#numpyè¿œæ¯”pandaså—
%timeit np1.dot(np2)    
%timeit np.dot(np1,np2)
%timeit np.dot(df1.values,df2.values)
```
pythonçš„forå¾ªç¯å®ŒæˆçŸ©é˜µä¹˜æ³•
```python
for i in x2:
    res = []
    for j in i:
        res.append(int(j))
    x3.append(res)

def f(x,y):
    res = []
    for i in range(len(x)):
        row = []
        for j in range(len(y[0])):
            sum_row = 0
            for k in range(len(x[0])):
                sum_row+=x[i][k]*y[k][j]
            row.append(sum_row)
        res.append(row)
    return res

%timeit f(x)
```
å°ç»“ï¼š
```
f(df1,df2)>f(np1,np2)>df1.dot(df2)> np.dot(df1,df2)>np.dot(df1.values,df2.values)>np.dot(np1,np2)>np1.dot(np2)  
```  

### å¹¿æ’­è¿ç®—

å¦‚æœä¸¤ä¸ªæ•°ç»„çš„å½¢çŠ¶åœ¨ç»´åº¦ä¸Šä¸åŒ¹é…ï¼Œé‚£ä¹ˆæ•°ç»„çš„å½¢å¼ä¼šæ²¿ç€ç»´åº¦ä¸º1çš„ç»´åº¦è¿›è¡Œæ‰©å±•ï¼Œä»¥åŒ¹é…å¦ä¸€ä¸ªæ•°ç»„çš„å½¢çŠ¶ã€‚

è‹¥æ‰©å±•ä¹Ÿæ— æ³•è®©ä¸¤ä¸ªæ•°ç»„çš„å½¢çŠ¶ä¸€æ ·ï¼Œå°±ä¼šæŠ¥é”™ã€‚
```python
np.random.seed(42)
x = pd.DataFrame(np.random.randint(10,size=(3,3)),columns=list('ABC'))
```
```python
x.iloc[0]                #å–0è¡Œ
x/x.iloc[0]              #æ¯ä¸€è¡Œéƒ½é™¤ä»¥0è¡Œ 
x.A
x.div(x.A,axis=0)        #æ¯ä¸€åˆ—éƒ½é™¤ä»¥Aåˆ— 
x.div(x.iloc[0],axis=1)  #æ¯ä¸€è¡Œéƒ½é™¤ä»¥0è¡Œ 
å½“axisç¼ºçœæ—¶é»˜è®¤ä¸º1ï¼Œ1ä¸ºè¡Œï¼Œ0ä¸ºåˆ—
```

### ç´¢å¼•å¯¹é½

ä»¥åŠ ä¸ºä¾‹ã€‚
```python
A = pd.DataFrame(np.random.randint(0,20,size=(2,2)),columns=list('AB'))

B = pd.DataFrame(np.random.randint(0,10,size=(3,3)),columns=list('ABC'))
A+B
A.add(B,fill_value = 0)
```
pandasä¼šè‡ªåŠ¨å¯¹é½ä¸¤ä¸ªå¯¹è±¡çš„ç´¢å¼•ï¼Œæ²¡æœ‰çš„å€¼ç”¨numpyçš„NaNè¡¨ç¤ºã€‚

ç¼ºå¤±å€¼ä¹Ÿå¯ä»¥ç”¨fill_valueæ¥å¡«å……ï¼Œå¡«å……ä»¥åå†ç›¸åŠ ã€‚

### æ’åº

```python
df = pd.DataFrame({
    'col1': ['A', 'A', 'B', np.nan, 'D', 'C'],
    'col2': [2, 1, 9, 8, 7, 4],
    'col3': [0, 1, 9, 4, 2, 3],})
```

#### æŒ‰åˆ—æ•°æ®æˆ–è¡Œæ•°æ®æ’åº

ä¸€ä¸ªæ ‡ç­¾ä¸‹è¿›è¡Œæ’åºçš„æ•°æ®ï¼Œæ•°æ®ç±»å‹å¿…é¡»ç›¸åŒã€‚è‹¥åŒæ—¶æœ‰å­—ç¬¦ä¸²å’Œæ•°å­—ï¼Œä¼šæŠ¥é”™ã€‚

DataFrame.sort_values(by=,axis=0,ascending=True, inplace=False, kind='quicksort', na_position=â€˜lastâ€™)

axis=0æˆ–'index'æ—¶ï¼ŒbyæŒ‡å®šåˆ—åï¼ŒæŒ‰ç…§æŒ‡å®šåˆ—ä¸­æ•°æ®å¤§å°æ’åºã€‚

axis=1æˆ–'columns'æ—¶,byæŒ‡å®šç´¢å¼•å€¼ï¼ŒæŒ‰ç…§æŒ‡å®šè¡Œä¸­æ•°æ®å¤§å°æ’åºã€‚

ascendingï¼šTrueè¡¨ç¤ºå‡åºæ’åˆ—ï¼Œé»˜è®¤ä¸ºTrueã€‚

inplaceï¼šæ˜¯å¦ç”¨æ’åºåçš„æ•°æ®é›†æ›¿æ¢åŸæ¥çš„æ•°æ®ï¼Œé»˜è®¤ä¸ºFalse

kindï¼š{â€˜quicksortâ€™, â€˜mergesortâ€™, â€˜heapsortâ€™},  è®¾ç½®æ’åºçš„ç®—æ³•ï¼Œé»˜è®¤ä¸ºâ€˜quicksortâ€™

na_positionï¼š{â€˜firstâ€™,â€˜lastâ€™}ï¼Œè®¾å®šç¼ºå¤±å€¼çš„æ˜¾ç¤ºä½ç½®
```python
df.sort_values(by=['col2'])     #æŒ‰ç…§åˆ—col2çš„æ•°æ®è¿›è¡Œé€’å¢æ’åº
df.sort_values(by=['col2','col3'],ascending=False)    #å…ˆä¾æ®ç¬¬äºŒæ•°æ®é™åºæ’åºï¼Œè‹¥ç¬¬äºŒåˆ—ç›¸åŒåˆ™æŒ‰ç¬¬ä¸‰åˆ—æ’
df.sort(by=0,axis=1)    #å› ä¸ºç¬¬ä¸€è¡Œä¸­æ•°æ®çš„æ•°æ®ç±»å‹æœ‰å­—ç¬¦å’Œæ•°å­—ï¼Œä¸èƒ½æ¯”è¾ƒï¼Œæ‰€ä»¥æŠ¥é”™ã€‚
```
#### æŒ‰ç…§æ ‡ç­¾åè¿›è¡Œæ’åº

DataFrame.sort_index(axis=0, ascending=True, inplace=False, kind='quicksort', na_position='last')

axisï¼š0è¡¨ç¤ºæŒ‰è¡Œåæ’åºï¼Œ1è¡¨ç¤ºæŒ‰åˆ—åæ’åºï¼Œé»˜è®¤ä¸º0ã€‚

ascendingï¼šTrueè¡¨ç¤ºå‡åºæ’åˆ—ï¼Œé»˜è®¤ä¸ºTrueã€‚

inplaceï¼šæ˜¯å¦ç”¨æ’åºåçš„æ•°æ®é›†æ›¿æ¢åŸæ¥çš„æ•°æ®ï¼Œé»˜è®¤ä¸ºFalse

kindï¼š{â€˜quicksortâ€™, â€˜mergesortâ€™, â€˜heapsortâ€™},  è®¾ç½®æ’åºçš„ç®—æ³•ï¼Œé»˜è®¤ä¸ºâ€˜quicksortâ€™

na_positionï¼š{â€˜firstâ€™,â€˜lastâ€™}ï¼Œè®¾å®šç¼ºå¤±å€¼çš„æ˜¾ç¤ºä½ç½®
```python
df.sort_index()         #æŒ‰è¡Œåæ’åº
df.sort_index(axis=1)   #æŒ‰åˆ—åæ’åº
```

### ç»Ÿè®¡

* [æ¯åˆ—çš„æ€»ä½“é¢è²Œ](#æ¯åˆ—çš„æ€»ä½“é¢è²Œ)
* [å–å€¼çš„é›†åˆ](#å–å€¼çš„é›†åˆ)
* [ä¸€åˆ—ä¸­æ¯ç§å…ƒç´ çš„ä¸ªæ•°](#ç»Ÿè®¡ä¸€åˆ—ä¸­æ¯ç§å…ƒç´ çš„ä¸ªæ•°)
* [æ¯åˆ—ä¸­éç©ºå…ƒç´ ä¸ªæ•°](#æ¯åˆ—ä¸­éç©ºå…ƒç´ ä¸ªæ•°)
* [æ¯åˆ—æˆ–æ¯è¡Œå…ƒç´ æ±‚å’Œ](#æ¯åˆ—æˆ–æ¯è¡Œå…ƒç´ æ±‚å’Œ)
* [æ¯åˆ—æˆ–æ¯è¡Œçš„æœ€å€¼](#æ¯åˆ—æˆ–æ¯è¡Œçš„æœ€å€¼)
* [æ¯åˆ—æˆ–æ¯è¡Œçš„å‡å€¼_æ–¹å·®_æ ‡å‡†å·®](#æ¯åˆ—æˆ–æ¯è¡Œçš„å‡å€¼_æ–¹å·®_æ ‡å‡†å·®)
* [æ¯åˆ—çš„ä»»æ„åˆ†ä½æ•°](#æ¯åˆ—çš„ä»»æ„åˆ†ä½æ•°)
* [ç›¸å…³ç³»æ•°](#ç›¸å…³ç³»æ•°)

#### æ¯åˆ—çš„æ€»ä½“é¢è²Œ

df.describe()

æ•°å€¼å‹ï¼šè¿”å›æ¯åˆ—ä¸­éç©ºå…ƒç´ ä¸ªæ•°ï¼Œå‡å€¼ï¼Œæ ‡å‡†å·®ï¼Œæœ€å€¼ï¼Œ25%ï¼Œ50%ï¼Œ75%åˆ†ä½æ•°ã€‚

å­—ç¬¦å‹ï¼šè¿”å›æ¯åˆ—ä¸­éç©ºå…ƒç´ ä¸ªæ•°ï¼Œå–å€¼çš„é›†åˆï¼Œå‡ºç°é¢‘ç‡æœ€é«˜çš„å€¼å’Œå‡ºç°çš„æ¬¡æ•°ã€‚

```python
df2=pd.DataFrame([['a','b','c','d'],
                 ['e','a','c','f'],
                 ['d','c','r','g']],columns=list('ABCD'))
df2.describe()
```

#### å–å€¼çš„é›†åˆ

np.unique(numpy)

np.unique(DataFrame)
```python
y = np.random.randint(3,size=20)
print(y)
np.unique(y)    #numpyå¯¹è±¡
'''
[2 2 2 1 2 1 1 2 1 2 2 0 2 0 2 2 0 0 2 1]
array([0, 1, 2])'''
y1 = pd.DataFrame(y, columns=['A'])
np.unique(y1)   #pandaså¯¹è±¡
'''
array([0, 1, 2])'''
```

#### ä¸€åˆ—ä¸­æ¯ç§å…ƒç´ çš„ä¸ªæ•°
```python
from collections import Counter
Counter(y)
'''
Counter({2: 11, 1: 5, 0: 4})'''
y1['A'].value_counts()  #è¿™æ˜¯Serieså¯¹è±¡ä¸­çš„æ–¹æ³•
'''
2    11
1     5
0     4
Name: A, dtype: int64'''
```

#### æ¯åˆ—ä¸­éç©ºå…ƒç´ ä¸ªæ•°

df.count()
```
b    4
a    4
c    4
dtype: int64
```

#### æ¯åˆ—æˆ–æ¯è¡Œå…ƒç´ æ±‚å’Œ

df.sum(axis=0)

axiså¯ç¼ºçœï¼Œé»˜è®¤ä¸º0ã€‚0è¡¨ç¤ºæ¯åˆ—å…ƒç´ æ±‚å’Œï¼Œ1è¡¨ç¤ºæ¯è¡Œå…ƒç´ æ±‚å’Œã€‚

#### æ¯åˆ—æˆ–æ¯è¡Œçš„æœ€å€¼

æœ€å°å€¼ï¼šdf.min(axis=0) 

æœ€å¤§å€¼ï¼šdf.max(axis=0)

æœ€å¤§å€¼çš„åæ ‡ï¼šdf.idxmax(axis=0)

æœ€å°å€¼çš„åæ ‡ï¼šdf.idxmin(axis=0)

axiså¯ç¼ºçœï¼Œé»˜è®¤ä¸º0ã€‚0è¡¨ç¤ºåˆ—ï¼Œ1è¡¨ç¤ºè¡Œã€‚

#### æ¯åˆ—æˆ–æ¯è¡Œçš„å‡å€¼_æ–¹å·®_æ ‡å‡†å·®

å‡å€¼ï¼šdf.mean(axis=0)

æ–¹å·®ï¼šdf.var(axis=0)ï¼ˆè´å¡å°”æ ¡æ­£ï¼‰

æ ‡å‡†å·®ï¼šdf.std(axis=0)ï¼ˆè´å¡å°”æ ¡æ­£ï¼‰

axiså¯ç¼ºçœï¼Œé»˜è®¤ä¸º0ã€‚0è¡¨ç¤ºåˆ—ï¼Œ1è¡¨ç¤ºè¡Œã€‚

æ ·æœ¬æ–¹å·®æ˜¯æ˜¯å…³äºæ€»ä½“æ–¹å·®çš„æ— åä¼°è®¡é‡ï¼Œæ—¢æ ·æœ¬æ–¹å·®çš„ä¼°è®¡é‡çš„æœŸæœ›ç­‰äºæ€»ä½“æ–¹å·®ã€‚è€Œæ²¡æœ‰ä¿®æ­£çš„æ–¹å·®å…¬å¼ï¼Œå®ƒçš„æœŸæœ›æ˜¯ä¸ç­‰äºæ€»ä½“æ–¹å·®çš„ã€‚

[æ ·æœ¬æ–¹å·®](https://blog.csdn.net/Hearthougan/article/details/77859173)è¦é™¤ä»¥ï¼ˆn-1ï¼‰è€Œä¸æ˜¯é™¤ä»¥nã€‚[store](https://github.com/zyxhzsh/math-is-good/blob/master/pythonä¸­çš„æ•°å­¦/æ ·æœ¬æ–¹å·®ä¸ºä½•é™¤ä»¥n-1.pdf)

#### æ¯åˆ—æˆ–æ¯è¡Œçš„ä¸­ä½æ•°_ä¼—æ•°

ä¸­ä½æ•°ï¼šdf.median(axis=0)

ä¼—æ•°ï¼šdf.mode(axis=0)ã€‚è‹¥æœ‰å¤šä¸ªä¼—æ•°ä¼šæ˜¾ç¤ºå¤šè¡Œã€‚

axiså¯ç¼ºçœï¼Œé»˜è®¤ä¸º0ã€‚0è¡¨ç¤ºåˆ—ï¼Œ1è¡¨ç¤ºè¡Œã€‚

#### æ¯åˆ—çš„ä»»æ„åˆ†ä½æ•°

åˆ†ä½æ•°ï¼ˆQuantileï¼‰ï¼Œäº¦ç§°åˆ†ä½ç‚¹ï¼Œæ˜¯æŒ‡å°†ä¸€ä¸ªéšæœºå˜é‡çš„æ¦‚ç‡åˆ†å¸ƒèŒƒå›´åˆ†ä¸ºå‡ ä¸ªç­‰ä»½çš„æ•°å€¼ç‚¹ã€‚

df.quantile(0.75)

#### ç›¸å…³ç³»æ•°

df.corr()   #ç›¸å…³ç³»æ•°çŸ©é˜µ

df.corrwith(df['a'])         #çœ‹ä¸€åˆ—çš„ç›¸å…³ç³»æ•°

### applyè‡ªå®šä¹‰æ¯è¡Œæˆ–æ¯åˆ—ç›¸åº”æ“ä½œ

apply(method):ä½¿ç”¨methodæ–¹æ³•é»˜è®¤å¯¹æ¯ä¸€åˆ—è¿›è¡Œç›¸åº”æ“ä½œã€‚

axiså¯ç¼ºçœï¼Œé»˜è®¤ä¸º0ã€‚0è¡¨ç¤ºåˆ—ï¼Œ1è¡¨ç¤ºè¡Œã€‚

```python
df.apply(np.cumsum)     #å¯¹æ•°æ®ç´¯åŠ 

df.apply(lambda x:x.max()-x.min())  #è‡ªå®šä¹‰å‡½æ•°ï¼Œæ¯åˆ—çš„æœ€å¤§å€¼å‡æœ€å°å€¼           

è‡ªå®šä¹‰å‡½æ•°
def my_describe(x):
    return pd.Series([x.count(),x.mean(),x.max(),x.idxmin(),x.std()],index=['Count','mean','max','idxmin','std'])
df.apply(my_describe)
```

### å¤§é‡æ•°æ®çš„é«˜æ€§èƒ½è®¡ç®—

- **pd.eval('è¡¨è¾¾å¼')**:å‡å°‘å¤åˆä»£æ•°å¼è®¡ç®—ä¸­é—´è¿‡ç¨‹çš„å†…å­˜åˆ†é…ï¼Œä»è€Œæå‡é€Ÿåº¦ã€‚è‹¥å†…å­˜å¤Ÿç”¨ï¼Œevalåè€Œé€Ÿåº¦æ›´æ…¢ã€‚

```python
df1, df2, df3, df4 = (pd.DataFrame(np.random.random((10000,1000))) for i in rangge(4))
```
```python
%timeit (df1+df2)/(df3+df4)
'''
60.3 ms Â± 1.68 ms per loop (mean Â± std. dev. of 7 runs, 10 loops each)'''

%timeit pd.eval('(df1+df2)/(df3+df4)')
'''
30 ms Â± 1.04 ms per loop (mean Â± std. dev. of 7 runs, 10 loops each)'''

åˆ¤æ–­ç»“æœæ˜¯å¦ä¸€æ ·
np.allclose ((df1+df2)/(df3+df4), pd.eval('(df1+df2)/(df3+df4)'))
```

- **query()**


df[(df.A<0.5)&(df.B>0.5)]ç­‰äº

df.query('(A<0.5)&(B>0.5)')
```python
ç”±äºæ•°æ®è¾ƒå°ï¼Œquery()æ›´æ…¢ã€‚

df = pd.DataFrame({'A': range(1, 6),
                   'B': range(10, 0, -2),
                   'C C': range(10, 5, -1)})

%timeit df[(df.A<0.5)&(df.B>0.5)]
'''
574 Âµs Â± 11.2 Âµs per loop (mean Â± std. dev. of 7 runs, 1000 loops each)'''
%timeit df.query('(A<0.5)&(B>0.5)')
'''
2.01 ms Â± 39.5 Âµs per loop (mean Â± std. dev. of 7 runs, 100 loops each)'''


åˆ¤æ–­ç»“æœæ˜¯å¦ä¸€æ ·
np.allclose(df[(df.A<0.5)&(df.B>0.5)],df.query('(A<0.5)&(B>0.5)'))
```